<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8"/>
	<title th:text="CONSULTAS"></title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
	<link rel="stylesheet" th:href="@{/css/estilos.css}">
	<link rel="stylesheet" th:href="@{/css/tema_light}">
</head>
<body>
	<header>
		<div class="logo">
		  <img th:src="@{/img/logo.png}" alt="Logo">
		</div>
		<div class="logout">
		  <a th:href="@{/medicos}" style="color: #adc9d3;" class="btn btn-link">Logout</a>
		</div>
	  </header>
	  
	<div class="container">
		<div class="card bg-light">
			<div class="card-body">
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="border: 1px solid black;">Paciente</th>
							<th style="border: 1px solid black;">Hora de la cita</th>
							<th style="border: 1px solid black;">Estado</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="Consulta: ${consultas}">
							<td>
								<span th:text="${Consulta.paciente.nombre}"></span><span>&nbsp</span><span th:text="${Consulta.paciente.apellidos}"></span>
							</td> 
							<td th:text="${Consulta.cita.hora}">10:00</td>
							<th:block th:if="${Consulta.status == 0}">
								<td>ESPERANDO</td>
							</th:block>
							<th:block th:if="${Consulta.status == 1}">
								<td>EN CURSO</td>
							</th:block>
							<th:block th:if="${Consulta.status == 2}">
								<td>FINALIZADA</td>
							</th:block>
							<td>
								<div>
									<a th:href="@{/historial}" target="_blank" rel="noopener" class="btn btn-outline-secondary btn-sm">Historial</a>
								    </br></br>
									<a th:href="@{/recetas}"  target="_new" class="btn btn-outline-secondary btn-sm">Recetas</a>
								    </br></br>
									<a th:href="@{/pruebas}"  target="_new" class="btn btn-outline-secondary btn-sm">Solicitar prueba</a>
								    </br></br>
									<a th:href="@{/citas}"  target="_new" class="btn btn-outline-secondary btn-sm">Nueva cita</a>
								    </br></br>
								</div>
							</td>
							<td>
								<a th:href="@{/llamar/} + ${Consulta.id}" class="btn btn-success" style="font-weight:bold; border: 1px solid black;">LLAMAR</a>
							</td>
							<td>
								<a th:href="@{/finalizar/} + ${Consulta.id}" class="btn btn-primary" style="font-weight:bold; border: 1px solid black;">FINALIZAR</a> 
							</td>
							<th:block th:if="${Consulta.status == 1}">
							<td>
								<p id="tiempo-transcurrido">Tiempo de consulta: 0 segundos</p>
								<script th:inline="javascript">
								/* Obtiene el tiempo inicial del servidor, usando Thymeleaf */
								var tiempoInicial = /*[[${#dates.createNow()}]]*/ new Date().getTime();
								var intervaloTiempo = 1;

								setInterval(function() {
									var tiempoActual = new Date().getTime();
									var tiempoTranscurrido = Math.floor((tiempoActual - tiempoInicial) / 1000);
									document.getElementById("tiempo-transcurrido").innerHTML = "Tiempo de consulta: " + tiempoTranscurrido + " segundos";
								}, intervaloTiempo * 1000);
								</script>
							</td>
							</th:block>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>
</html>
